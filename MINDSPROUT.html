<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MINDSPROUT</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.16.0",
    "jspdf": "https://aistudiocdn.com/jspdf@^3.0.2",
    "html2canvas": "https://aistudiocdn.com/html2canvas@^1.4.1"
  }
}
</script>
<style>
:root {
    --primary-color: #4CAF50;
    --primary-hover: #45a049;
    --secondary-color: #FFC107;
    --background-color: #f9f9f9;
    --text-color: #333;
    --card-bg: #ffffff;
    --border-radius: 12px;
    --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding: 20px;
}

#root {
    width: 100%;
    max-width: 900px;
}

.container {
    background-color: var(--card-bg);
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    text-align: center;
    transition: all 0.3s ease;
}

.header {
    margin-bottom: 1.5rem;
}

.header h1 {
    font-size: 2.5rem;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.header h1::before {
    content: 'ðŸŒ±';
    font-size: 2.5rem;
}

.header p {
    color: #666;
    margin-top: 0.5rem;
}

.upload-section {
    margin-bottom: 1.5rem;
}

.upload-guidance {
    margin-top: 1.5rem;
    font-size: 0.875rem;
    color: #444;
    text-align: left;
    max-width: 450px;
    margin-left: auto;
    margin-right: auto;
    background-color: #f7f9fc;
    padding: 1rem;
    border-radius: var(--border-radius);
    border: 1px solid #e3e8f0;
}

.upload-guidance p {
    margin: 0;
    padding-left: 1.5rem;
    position: relative;
    line-height: 1.6;
}

.upload-guidance p:first-child {
    margin-bottom: 0.75rem;
}

.upload-guidance p::before {
    position: absolute;
    left: 0;
    top: 2px;
    font-size: 1rem;
}

.upload-guidance p:nth-of-type(1)::before {
    content: 'ðŸ’¡';
}

.upload-guidance p:nth-of-type(2)::before {
    content: 'ðŸ”’';
}

.file-input-wrapper {
    position: relative;
    display: inline-block;
    cursor: pointer;
    margin-bottom: 1rem;
    width: 100%;
    max-width: 400px;
}

.file-drop-zone {
    border: 2px dashed #ccc;
    border-radius: var(--border-radius);
    padding: 2rem;
    transition: border-color 0.3s, background-color 0.3s;
    background-color: #fafafa;
}

.file-drop-zone:hover {
    border-color: var(--primary-color);
    background-color: #f5fef5;
}

.file-drop-zone p {
    color: #888;
    margin: 0;
}

.file-drop-zone .upload-icon {
    font-size: 2rem;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

#file-upload {
    display: none;
}

.image-preview {
    max-width: 200px;
    max-height: 200px;
    border-radius: var(--border-radius);
    margin-top: 1rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.additional-info {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.info-input {
    flex: 1;
    min-width: 150px;
    padding: 1rem;
    border: 1px solid #ccc;
    border-radius: var(--border-radius);
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    transition: border-color 0.3s, box-shadow 0.3s;
}

.info-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
}

.traits-input {
    width: 100%;
    padding: 1rem;
    border: 1px solid #ccc;
    border-radius: var(--border-radius);
    font-family: 'Poppins', sans-serif;
    font-size: 1rem;
    resize: vertical;
    transition: border-color 0.3s, box-shadow 0.3s;
}

.traits-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
}

.btn {
    background-color: var(--primary-color);
    color: white;
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
    margin-top: 1.5rem;
}

.btn:hover:not(:disabled) {
    background-color: var(--primary-hover);
    transform: translateY(-2px);
}

.btn:disabled {
    background-color: #ccc;
    cursor: not-allowed;
}

.loader-container {
    padding: 2rem;
    text-align: center;
}

.loader {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

.loader-container p {
    color: #666;
    font-weight: 600;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.result-section {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    text-align: left;
}

#downloadable-result {
    display: flex;
    gap: 2rem;
    background-color: #f8fdf8;
    padding: 2rem;
    border-radius: var(--border-radius);
    align-items: center;
    flex-direction: column;
}

.result-image {
    width: 100%;
    max-width: 300px;
    height: auto;
    object-fit: cover;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
}

.result-text {
    flex: 1;
}

.result-text h2 {
    color: var(--primary-color);
    margin-bottom: 1.5rem;
    text-align: center;
}

.result-text-content p {
    line-height: 1.8;
    color: #444;
    margin-bottom: 1rem;
}

.result-text-content p:last-child {
    margin-bottom: 0;
}

.result-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
    padding-top: 1.5rem;
    border-top: 1px solid #e0e0e0;
    flex-wrap: wrap;
}

.action-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    transition: background-color 0.2s ease-in-out;
    min-width: 110px;
}

.action-item:hover {
    background-color: #f0f0f0;
}

.action-icon {
    font-size: 2rem;
}

.action-item span {
    font-size: 0.875rem;
    font-weight: 600;
    color: #555;
}

.error-message {
    color: #D32F2F;
    background-color: #FFCDD2;
    padding: 1rem;
    border-radius: var(--border-radius);
    margin-top: 1rem;
}


@media (min-width: 768px) {
    #downloadable-result {
        flex-direction: row;
        text-align: left;
    }
    .result-text h2 {
        text-align: left;
    }
    .result-image {
        max-width: 350px;
    }
}
</style>
</head>
<body>
    <div id="root"></div>
    <script type="module">
/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */

import React, { useState, useEffect } from "react";
import ReactDOM from "react-dom/client";
import html2canvas from "html2canvas";
import jsPDF from "jspdf";
import { GoogleGenAI } from "@google/genai";

const App = () => {
    const [imageFile, setImageFile] = useState(null);
    const [imageBase64, setImageBase64] = useState('');
    const [imagePreview, setImagePreview] = useState('');
    const [childName, setChildName] = useState('');
    const [childAge, setChildAge] = useState('');
    const [childTraits, setChildTraits] = useState('');
    const [analysisResult, setAnalysisResult] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const [loadingMessage, setLoadingMessage] = useState('AIê°€ ì‚¬ì§„ì„ ìžì„¸ížˆ ì‚´íŽ´ë³´ê³  ìžˆì–´ìš”...');
    const [error, setError] = useState('');

    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

    // Loading messages rotation
    useEffect(() => {
        let interval;
        if (isLoading) {
            const messages = [
                "AIê°€ ì‚¬ì§„ì„ ìžì„¸ížˆ ì‚´íŽ´ë³´ê³  ìžˆì–´ìš”...",
                "ë†€ë¼ìš´ ìž¥ì ë“¤ì„ ì°¾ì•„ë‚´ê³  ìžˆì–´ìš”...",
                "íŠ¹ë³„í•œ ë©”ì‹œì§€ë¥¼ ë§Œë“¤ê³  ìžˆì–´ìš”...",
                "ë°ì€ ë¯¸ëž˜ë¥¼ ê·¸ë¦¬ê³  ìžˆì–´ìš”...",
            ];
            let index = 0;
            interval = setInterval(() => {
                index = (index + 1) % messages.length;
                setLoadingMessage(messages[index]);
            }, 2500);
        }
        return () => clearInterval(interval);
    }, [isLoading]);

    const handleFileChange = (e) => {
        const file = e.target.files?.[0];
        if (file && file.type.startsWith('image/')) {
            setImageFile(file);
            const reader = new FileReader();
            reader.onloadend = () => {
                if (typeof reader.result === 'string') {
                    const base64String = reader.result.split(',')[1];
                    setImageBase64(base64String);
                    setImagePreview(URL.createObjectURL(file));
                    setError('');
                }
            };
            reader.readAsDataURL(file);
        } else {
            setError('ì˜¬ë°”ë¥¸ ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
            resetFile();
        }
    };

    const resetFile = () => {
        setImageFile(null);
        setImageBase64('');
        setImagePreview('');
    };

    const generateAnalysis = async () => {
        if (!imageFile) {
            setError('ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
            return;
        }
        setIsLoading(true);
        setError('');
        setAnalysisResult('');

        try {
            const systemInstruction = "ë‹¹ì‹ ì€ 'MINDSPROUT'ìž…ë‹ˆë‹¤. ì„ ìƒë‹˜ê³¼ ë¶€ëª¨ë‹˜ì„ ìœ„í•œ ì¹œì ˆí•˜ê³  ê²©ë ¤í•˜ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ìž…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ëª©ì ì€ ì•„ì´ì˜ ì‚¬ì§„ê³¼ ì œê³µëœ ì´ë¦„, ë‚˜ì´, íŠ¹ì§•ì„ ë¶„ì„í•˜ì—¬ ê¸ì •ì ì´ê³ , íž˜ì„ ë¶ë‹ì•„ ì£¼ë©°, ë™ê¸°ë¥¼ ë¶€ì—¬í•˜ëŠ” ê°œì¸í™”ëœ ë¶„ì„ì„ ìƒì„±í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì–´ì¡°ëŠ” í˜„ëª…í•˜ê³  ì¹œì ˆí•œ ì´ì•¼ê¸°ê¾¼ì²˜ëŸ¼ ë¶€ë“œëŸ½ê³ , ì°½ì˜ì ì´ë©°, ì˜ê°ì„ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ì ˆëŒ€ë¡œ ë¶€ì •ì ì´ê±°ë‚˜ ë¹„íŒìœ¼ë¡œ ì˜¤í•´ë  ìˆ˜ ìžˆëŠ” ë§ì€ í•˜ì§€ ë§ˆì„¸ìš”. ìž ìž¬ë ¥, ì°½ì˜ì„±, ê·¸ë¦¬ê³  ë…íŠ¹í•œ ê°•ì ì— ì´ˆì ì„ ë§žì¶”ì„¸ìš”. ê´€ì°°í•œ ë‚´ìš©ì„ ìž¬ë¯¸ìžˆê³  ìƒìƒë ¥ì´ í’ë¶€í•œ í•´ì„ìœ¼ë¡œ í‘œí˜„í•˜ì„¸ìš”. ì§§ê³  ê¸ì •ì ì´ë©° í•œë‘ ë¬¸ë‹¨ ê¸¸ì´ë¡œ ìœ ì§€í•˜ì„¸ìš”.";
            
            const prompt = `ì´ ì•„ì´ì˜ ì´ë¦„ì€ '${childName || 'ì œê³µë˜ì§€ ì•ŠìŒ'}'ì´ê³ , ë‚˜ì´ëŠ” '${childAge || 'ì œê³µë˜ì§€ ì•ŠìŒ'}'ìž…ë‹ˆë‹¤. ì•„ì´ì˜ íŠ¹ì§•ì€ '${childTraits || 'ì œê³µëœ íŠ¹ì§• ì—†ìŒ'}' ìž…ë‹ˆë‹¤. ì´ ì •ë³´ì™€ ì‚¬ì§„ì„ ë°”íƒ•ìœ¼ë¡œ, ì´ ì•„ì´ì˜ ë©‹ì§„ ìž ìž¬ë ¥ì— ëŒ€í•œ ìž¬ë¯¸ìžˆê³  ê¸ì •ì ì¸ ë¶„ì„ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”. ì˜ˆë¥¼ ë“¤ì–´, ì•„ì´ì˜ ëˆˆì´ ë°˜ì§ì¸ë‹¤ë©´ í˜¸ê¸°ì‹¬ì˜ ë¶ˆê½ƒì„ ê°€ì§€ê³  ìžˆë‹¤ê³  ë§í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë§Œì•½ ì•„ì´ê°€ ì›ƒê³  ìžˆë‹¤ë©´, ë‹¤ë¥¸ ì‚¬ëžŒì—ê²Œë„ ì „ì—¼ë˜ëŠ” ì¦ê±°ì›€ì„ ê°€ì§€ê³  ìžˆë‹¤ê³  ì–¸ê¸‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì´ë¦„, ë‚˜ì´, íŠ¹ì§•ì„ ë¶„ì„ì— ìžì—°ìŠ¤ëŸ½ê²Œ ë…¹ì—¬ì£¼ì„¸ìš”.`;

            const imagePart = {
                inlineData: {
                    mimeType: imageFile.type,
                    data: imageBase64,
                },
            };

            const textPart = {
                text: prompt,
            };

            const response = await ai.models.generateContent({
                model: 'gemini-2.5-flash',
                contents: { parts: [imagePart, textPart] },
                config: {
                    systemInstruction: systemInstruction,
                }
            });
            
            setAnalysisResult(response.text);

        } catch (err) {
            console.error(err);
            setError('ì•—! AIê°€ ìž ì‹œ íœ´ì‹ ì¤‘ì´ì—ìš”. ìž ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        } finally {
            setIsLoading(false);
        }
    };
    
    const downloadResult = async (format) => {
        const element = document.getElementById('downloadable-result');
        if (!element) return;
        
        element.style.backgroundColor = '#FFFFFF';
        
        const canvas = await html2canvas(element, { scale: 2, useCORS: true });
        
        element.style.backgroundColor = '';

        if (format === 'png') {
            const dataUrl = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = 'mindsprout-analysis.png';
            link.click();
        } else if (format === 'pdf') {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF({
                orientation: 'landscape',
                unit: 'px',
                format: [canvas.width, canvas.height]
            });
            pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
            pdf.save('mindsprout-analysis.pdf');
        }
    };
    
    const resetApp = () => {
        resetFile();
        setChildName('');
        setChildAge('');
        setChildTraits('');
        setAnalysisResult('');
        setError('');
        setIsLoading(false);
    };

    const renderInitialState = () => React.createElement(React.Fragment, null,
        React.createElement("div", { className: "header" },
            React.createElement("h1", null, "MINDSPROUT"),
            React.createElement("p", null, "ì‚¬ì§„ í•œ ìž¥ìœ¼ë¡œ, ì•„ì´ì—ê²Œ ë”°ëœ»í•œ ë™ê¸°ë¶€ì—¬ì™€ ë¯¸ì†Œë¥¼ ì„ ë¬¼í•˜ì„¸ìš”.")
        ),
        React.createElement("div", { className: "upload-section" },
            !imagePreview && React.createElement("label", { htmlFor: "file-upload", className: "file-input-wrapper" },
                React.createElement("div", { className: "file-drop-zone" },
                    React.createElement("div", { className: "upload-icon" }, "ðŸ“·"),
                    React.createElement("p", null, imageFile ? imageFile.name : 'í´ë¦­í•˜ê±°ë‚˜ ì‚¬ì§„ì„ ì´ê³³ìœ¼ë¡œ ë“œëž˜ê·¸í•˜ì„¸ìš”')
                )
            ),
            React.createElement("input", { id: "file-upload", type: "file", accept: "image/*", onChange: handleFileChange, "aria-label": "ì‚¬ì§„ ì—…ë¡œë“œ" }),
            imagePreview && React.createElement("img", { src: imagePreview, alt: "Child preview", className: "image-preview" }),
            !imagePreview && React.createElement("div", { className: "upload-guidance" },
                React.createElement("p", null, "ë”ìš± ìžì„¸í•œ ë¶„ì„ì„ ìœ„í•´ ì•„ì´ì˜ ì–¼êµ´ì´ ìž˜ ë‚˜ì˜¨ ë‹¨ë… ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”."),
                React.createElement("p", null, "ì—…ë¡œë“œëœ ì‚¬ì§„ì€ ë¶„ì„ì—ë§Œ ì‚¬ìš©ë˜ë©°, ë¶„ì„ ì§í›„ ì¦‰ì‹œ ì‚­ì œë˜ë‹ˆ ì•ˆì‹¬í•˜ì„¸ìš”.")
            )
        ),
        React.createElement("div", { className: "additional-info" },
            React.createElement("input", {
                type: "text",
                className: "info-input",
                placeholder: "ì´ë¦„ ë˜ëŠ” ë‹‰ë„¤ìž„",
                value: childName,
                onChange: (e) => setChildName(e.target.value),
                "aria-label": "ì´ë¦„ ë˜ëŠ” ë‹‰ë„¤ìž„"
            }),
            React.createElement("input", {
                type: "text",
                className: "info-input",
                placeholder: "í•™ë…„ ë˜ëŠ” ë‚˜ì´",
                value: childAge,
                onChange: (e) => setChildAge(e.target.value),
                "aria-label": "í•™ë…„ ë˜ëŠ” ë‚˜ì´"
            })
        ),
        React.createElement("textarea", {
            className: "traits-input",
            placeholder: "ì•„ì´ì˜ ì–´ë–¤ ì ì´ íŠ¹ë³„í•œê°€ìš”? (ì˜ˆ: 'ê·¸ë¦¼ ê·¸ë¦¬ê¸°ë¥¼ ì¢‹ì•„í•´ìš”', 'í˜¸ê¸°ì‹¬ì´ ë§Žì•„ìš”')",
            value: childTraits,
            onChange: (e) => setChildTraits(e.target.value),
            "aria-label": "ì•„ì´ì˜ íŠ¹ë³„í•œ ì "
        }),
        error && React.createElement("p", { className: "error-message" }, error),
        React.createElement("button", { className: "btn", onClick: generateAnalysis, disabled: !imageFile || isLoading }, "ìƒˆì‹¹ ë¶„ì„")
    );

    const renderLoadingState = () => React.createElement("div", { className: "loader-container" },
        React.createElement("div", { className: "loader" }),
        React.createElement("p", null, loadingMessage)
    );
    
    const renderResultState = () => React.createElement("div", { className: "result-section" },
        React.createElement("div", { id: "downloadable-result" },
            React.createElement("img", { src: imagePreview, alt: "Child", className: "result-image" }),
            React.createElement("div", { className: "result-text" },
                React.createElement("h2", null, (childName || 'ì•„ì´') + "ì˜ ë©‹ì§„ ê°€ëŠ¥ì„±ì˜ ë°œê²¬!"),
                React.createElement("div", { className: "result-text-content" },
                    analysisResult.split('. ').filter(sentence => sentence.trim() !== '').map((sentence, index, arr) =>
                        React.createElement("p", { key: index },
                            sentence.trim(),
                            index < arr.length - 1 ? '.' : ''
                        )
                    )
                )
            )
        ),
        React.createElement("div", { className: "result-actions" },
            React.createElement("div", { className: "action-item", onClick: () => downloadResult('png'), role: "button", tabIndex: 0, "aria-label": "ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œ" },
                React.createElement("div", { className: "action-icon" }, "ðŸ–¼ï¸"),
                React.createElement("span", null, "ì´ë¯¸ì§€ ì €ìž¥")
            ),
            React.createElement("div", { className: "action-item", onClick: () => downloadResult('pdf'), role: "button", tabIndex: 0, "aria-label": "PDFë¡œ ë‹¤ìš´ë¡œë“œ" },
                React.createElement("div", { className: "action-icon" }, "ðŸ“„"),
                React.createElement("span", null, "PDF ì €ìž¥")
            ),
            React.createElement("div", { className: "action-item", onClick: resetApp, role: "button", tabIndex: 0, "aria-label": "ë‹¤ì‹œ ì‹œìž‘í•˜ê¸°" },
                React.createElement("div", { className: "action-icon" }, "ðŸ”„"),
                React.createElement("span", null, "ë‹¤ì‹œ ì‹œìž‘")
            )
        )
    );

    return React.createElement("div", { className: "container" },
        isLoading ? renderLoadingState() : (analysisResult ? renderResultState() : renderInitialState())
    );
};

const container = document.getElementById('root');
if (container) {
    const root = ReactDOM.createRoot(container);
    root.render(React.createElement(App));
}
    </script>
</body>
</html>
